<!doctype html>
<!--suppress JSUnfilteredForInLoop -->
<html>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.1/nv.d3.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.1/nv.d3.min.css">

<div id="chart" style="height: 200px;">
    <svg></svg>
</div>

<script type="text/javascript">
    var chart = nv.models.multiBarHorizontalChart().stacked(true).showControls(false).showYAxis(false);
    var inputData = {
        "clans": ["fd", "ir", "u", "dnc", "kh", "pi"],
        "unregistered": [1, 0, 0, 0, 0, 1],
        "players": [["rafael", {"ir": 3}], ["piotrekmpc", {"dnc": 1}], ["fury", {"ir": 1}],
            ["catico", {"u": 2}], ["gazda", {"fd": 1}], ["thirtytwo", {"kh": 1}]]
    };

    function transform_data(data) {
        var rows = [];
        inputData.players.forEach(function (arr) {
            var user = arr[0];
            var userClans = arr[1];
            var values = inputData.clans.map(function (clan) {
                return {x: clan, y: userClans[clan] || 0};
            });
            rows.push({key: user, values: values});
        });
        rows.push({
            key: 'Unregistered',
            color: "grey",
            values: inputData.clans.map(function (clan, idx) {
                return {x: clan, y: inputData.unregistered[idx]};
            })
        });
        return rows;
    }
    d3.json('most-active-players-per-clan.result.json', function (data) {
        var newData = transform_data(inputData);
        d3.select('#chart svg').datum(newData)
                .transition().duration(500).call(chart);
    });
</script>

</body>
</html>
