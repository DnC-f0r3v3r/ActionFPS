<link rel="import" href="/assets/javascripts/bower_components/polymer/polymer.html">
<polymer-element name="live-events" attributes="initialJson liveUrl">

    <template>
        <style scoped>
            .live-events {
                margin:0;
                padding:0;
                list-style-type: none;
            }
            .live-events li {

            }
            .live-events li .when {
                width:5em;
                font-size:0.8em;
                display:inline-block;
                text-align: right;
            }
            .live-events li a {
                width:28em;
                display:inline-block;
                color:wheat;
                text-decoration: none;
            }
        </style>
        <ol class="live-events">
            <template repeat="{{event in events}}">
                <li><a href="/player/{{event.user}}/">{{event.title}}</a> <span class="when">{{event.when}}</span></li>
            </template>
        </ol>
    </template>

    <script>
        Polymer("live-events", {
            initialJsonChanged: function(_, newValue) {
                this.events = JSON.parse(newValue).slice(0,5);
            },
            onMessage: function(msg) {
                this.events = JSON.parse(msg.data).slice(0,5);
            },
            onClose: function() {
                this.websocket = new WebSocket(this.liveUrl);
                this.websocket.onmessage = this.onMessage.bind(this);
                this.websocket.onclose = this.onClose.bind(this);
            },
            liveUrlChanged: function() {
                this.websocket = new WebSocket(this.liveUrl);
                this.websocket.onmessage = this.onMessage.bind(this);
                this.websocket.onclose = this.onClose.bind(this);
            }
        });
    </script>

</polymer-element>