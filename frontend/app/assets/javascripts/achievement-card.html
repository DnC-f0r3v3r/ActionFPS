<link rel="import" href="/assets/javascripts/bower_components/polymer/polymer.html">
<polymer-element name="achievement-card" attributes="type achieved achievementTitle description remainingInLevel when progressInLevel totalInLevel level">
    <template>
<style scoped>

    .progress-radial {
        float: left;
        margin-right: 35px;
        position: relative;
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: 2px solid #2f3439;
        background-color: tomato;
        z-index:4;
    }

    /* -------------------------------------
     * Optional centered circle w/text
     * ------------------------------------- */
    .progress-radial .overlay {
        position: absolute;
        width: 60px;
        height: 60px;
        z-index:4;
        background-color: #fffde8;
        border-radius: 50%;
        margin-left: 10px;
        margin-top: 10px;
        text-align: center;
        line-height: 60px;
    }
    /* http://codepen.io/geedmo/pen/InFfd */
    .progress-100 {
        background-image: linear-gradient(90deg, #ff6347 50%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0)), linear-gradient(270deg, #ff6347 50%, #2f3439 50%, #2f3439);
    }
    .progress-0 {
        background-image: linear-gradient(90deg, #2f3439 50%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0)), linear-gradient(90deg, #ff6347 50%, #2f3439 50%, #2f3439);
    }
    .achievement {
        margin-bottom:0.6em;
        min-height: 85px;
        padding: 1em;
        border-radius: 1em;
        background: rgba(20, 20, 30, 0.4);

    }
    .achievement .cont {
        display:flex;
    }
    .achievement-left {
        width:120px;
    }
    .achievement-description {
        position:relative;
        flex:1;
    }
    .progress-radial {
        margin-left:10px;
        margin-bottom:0.6em;
    }
    .achievement.notAchieved .cont {
        opacity:0.6;
        transition: all 0.4s;
    }
    .achievement.notAchieved:hover .cont {
        opacity:0.8;
    }
    .progress-radial .overlay .txt {
    }
    p.achieved-on {
        position:absolute;
        top:0.1em;
        right:1em;
    }
    h3 {
        margin-top:0.7em;
    }
</style>
        <div class="achievement-{{type}} achievement {{ {achieved: achieved == 'true', notAchieved: achieved == 'false'} | tokenList}}">
            <div class="cont">
                <div class="achievement-left">
            <template if="{{progressInLevel}}">
                <div class="progress-radial" style="{{progStyle}}">
                    <div class="overlay">{{progress}}%</div>
                </div>
            </template>
            <template if="{{!progressInLevel}}">
                <template if="{{achieved == 'true'}}">
                <div class="progress-radial progress-100">
                        <div class="overlay">&#10004;</div>

                </div>
                </template>
                <template if="{{achieved == 'false'}}">

                    <div class="progress-radial progress-0">
                        <div class="overlay"></div>
                    </div>
                    </template>
            </template>
                </div>
                <div class="achievement-description">
                <header>
                    <h3>{{achievementTitle}}</h3>
                    <template if="{{description}}">
                        <p class="description">{{description}}</p>
                    </template>
                </header>
                    <section class="content"><content></content></section>
                    <template if="{{when}}">
                        <p class="achieved-on">{{when}}</p>
                    </template>
                </div>
            </div>
        </div>

    </template>

    <script>
        Polymer("achievement-card", {
            totalInLevelChanged: function() {
                this.progress = Math.round(100 * this.progressInLevel / this.totalInLevel);
                this.progStyle = (function(progress) {
                    if ( progress <= 50 ) {
                        var rightDeg = Math.round(90 + 3.6 * progress);
                        return "background-image: linear-gradient(90deg, #2f3439 50%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0)), linear-gradient("+rightDeg+"deg, #ff6347 50%, #2f3439 50%, #2f3439);";
                    } else {
                        var leftDeg = Math.round(3.6 * progress - 270);
                        return "background-image: linear-gradient("+leftDeg+"deg, #ff6347 50%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0)), linear-gradient(270deg, #ff6347 50%, #2f3439 50%, #2f3439);"
                    }
                })(this.progress);
            }
        });
    </script>

</polymer-element>