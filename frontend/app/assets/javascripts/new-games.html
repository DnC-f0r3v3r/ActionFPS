<link rel="import" href="/assets/javascripts/bower_components/polymer/polymer.html">
<polymer-element name="new-games" attributes="liveUrl">

    <template>
        <template repeat="{{game in games}}">
            <game-card gameJson="{{game}}" isNew="true"></game-card>
        </template>
    </template>

    <script>
        Polymer("new-games", {
            onMessage: function (msg) {
                var newGamesList = (this.games || []).slice();
                newGamesList.unshift(msg.data);
                this.games = newGamesList;
            },
            onClose: function () {
                setTimeout(this.liveUrlChanged.bind(this), 5000);
            },
            liveUrlChanged: function() {
                this.games = this.games || [];
                this.websocket = new WebSocket(this.liveUrl);
                this.websocket.onmessage = this.onMessage.bind(this);
                this.websocket.onclose = this.onClose.bind(this);
            }
        });
    </script>

</polymer-element>