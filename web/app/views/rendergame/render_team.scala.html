@import com.actionfps.gameparser.enrichers.JsonGameTeam
@import com.actionfps.gameparser.enrichers.JsonGamePlayer
@(team: JsonGameTeam, teamSpectators: Option[List[JsonGamePlayer]])
<div class="@team.name team">
    <div class="team-header">
        @defining(if(team.name.equalsIgnoreCase("cla"))
            "https://cloud.githubusercontent.com/assets/5359646/12695180/369c86da-c745-11e5-817f-46d8c4c42376.png"
        else "https://cloud.githubusercontent.com/assets/5359646/12695181/369cda90-c745-11e5-96eb-3f3669f80aed.png"
        ) { url =>
            <h3><img src="@url"/></h3>
        }
        <div class="result">
        @team.flags match {
            case Some(flags) => {
                <span class="score">@flags</span>
                <span class="subscore">@team.frags</span>
            }
            case None => {
                <span class="score">@team.frags</span>
            }
        }
        </div>
    </div>
    <div class="players">
        <ol>
            @team.players.map { player =>
                @{
                    val html = views.html.rendergame.render_game_team_player()
                    val js = org.jsoup.Jsoup.parse(html.body)
                    val target = js.select(".player")
                    player.flags match {
                        case None => target.select(".flags").remove()
                        case Some(flags) => target.select(".flags").first().text(s"$flags")
                    }
                    target.select(".frags").first().text(s"${player.frags}")
                    player.user match {
                        case Some(user) => target.select(".name a").attr("href", s"/player/?id=${user}").first().text(player.name)
                        case None => target.select(".name").first().text(player.name)
                    }
                    Html(target.outerHtml())
                }
            }
            @teamSpectators.map { spectators =>
                @spectators.map { spectator =>
                    @{
                        val html = views.html.rendergame.render_game_team_player()
                        val js = org.jsoup.Jsoup.parse(html.body)
                        val target = js.select(".spectator")
                        spectator.flags match {
                            case None => target.select(".flags").remove()
                            case Some(flags) => target.select(".flags").first().text(s"$flags")
                        }
                        target.select(".frags").first().text(s"${spectator.frags}")

                        spectator.user match {
                            case Some(user) => target.select(".name a").attr("href", s"/player/?id=${user}").first().text(spectator.name)
                            case None => target.select(".name").first().text(spectator.name)
                        }
                        Html(target.outerHtml())
                    }
                }
            }
        </ol>
    </div>
</div>
